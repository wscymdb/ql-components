---
title: åˆ†å±‚é…ç½®å¿«ç…§
toc: content
order: 8
---

# åˆ†å±‚é…ç½®å¿«ç…§

## æ¦‚è¿°

Upload SDK é‡‡ç”¨**å…¨å±€å•ä¾‹æ¨¡å¼** + **åˆ†å±‚é…ç½®å¿«ç…§**çš„è®¾è®¡ï¼Œè§£å†³å¤šç»„ä»¶åœºæ™¯ä¸‹çš„é…ç½®æ··ä¹±é—®é¢˜ã€‚

## æ ¸å¿ƒæ¦‚å¿µ

### 1. å…¨å±€é…ç½®ï¼ˆå®æ—¶ç”Ÿæ•ˆï¼‰

è¿™äº›é…ç½®åœ¨ `setup()` æ›´æ–°åï¼Œ**æ‰€æœ‰ä»»åŠ¡**ï¼ˆåŒ…æ‹¬é˜Ÿåˆ—ä¸­çš„ï¼‰ç«‹å³ä½¿ç”¨æ–°å€¼ï¼š

- `token` - è®¤è¯ä»¤ç‰Œ
- `serverUrl` - æœåŠ¡å™¨åœ°å€ï¼ˆåˆå§‹åŒ–åä¸å¯ä¿®æ”¹ï¼‰
- `chunkSize` - åˆ‡ç‰‡å¤§å°
- `chunkConcurrency` - åˆ‡ç‰‡å¹¶å‘æ•°
- `uploadConcurrency` - æ–‡ä»¶ä¸Šä¼ å¹¶å‘æ•°
- `hashConcurrency` - Hash è®¡ç®—å¹¶å‘æ•°

**é€‚ç”¨åœºæ™¯**ï¼šè¿è¡Œæ—¶å‚æ•°çš„åŠ¨æ€æ›´æ–°ï¼Œå¦‚ token åˆ·æ–°ã€‚

### 2. ä»»åŠ¡é…ç½®ï¼ˆå¿«ç…§ä¿å­˜ï¼‰

è¿™äº›é…ç½®åœ¨ä»»åŠ¡åˆ›å»ºæ—¶ä¿å­˜å¿«ç…§ï¼Œ**åªå¯¹æ–°ä»»åŠ¡ç”Ÿæ•ˆ**ï¼š

- `hooks` - ä¸šåŠ¡é’©å­å‡½æ•°
- `apiPaths` - API è·¯å¾„é…ç½®

**é€‚ç”¨åœºæ™¯**ï¼šç»‘å®šåˆ°ä»»åŠ¡åˆ›å»ºæ—¶çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œå¦‚ `datasetId`ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: Token åˆ·æ–°

```typescript
// åˆå§‹åŒ–
setup({
    serverUrl: "/api",
    token: "old_token"
})

// å¯åŠ¨ä¸Šä¼ ï¼ˆ100ä¸ªæ–‡ä»¶ï¼‰
startUpload(files) // 3ä¸ªåœ¨æ‰§è¡Œï¼Œ97ä¸ªåœ¨é˜Ÿåˆ—

// Token è¿‡æœŸï¼Œåˆ·æ–° token
setup({ token: "new_token" })

// âœ… é˜Ÿåˆ—ä¸­çš„ 97 ä¸ªä»»åŠ¡ä¼šè‡ªåŠ¨ä½¿ç”¨æ–° token
```

### åœºæ™¯ 2: ç»„ä»¶åˆ‡æ¢ï¼ˆdatasetId å˜åŒ–ï¼‰

```typescript
function DatasetUpload() {
    const [datasetId, setDatasetId] = useState('A')
    const { setup, startUpload, reset } = useUpload()

    useEffect(() => {
        // æ¯æ¬¡ datasetId å˜åŒ–ï¼Œé‡æ–°é…ç½® hooks
        setup({
            hooks: {
                onCheck: () => ({ datasetId })  // é—­åŒ…æ•è·å½“å‰ datasetId
            }
        })

        return () => {
            // ç»„ä»¶å¸è½½æ—¶æ¸…ç†æ‰€æœ‰ä»»åŠ¡
            reset()
        }
    }, [datasetId])

    const handleUpload = (files) => {
        startUpload(files)
    }

    return (
        <div>
            <Select value={datasetId} onChange={setDatasetId}>
                <Option value="A">Dataset A</Option>
                <Option value="B">Dataset B</Option>
            </Select>
            <Upload onChange={handleUpload} />
        </div>
    )
}
```

**æ‰§è¡Œæµç¨‹**ï¼š

```
T1: datasetId = 'A'
    â†’ setup({ hooks: { onCheck: () => ({ datasetId: 'A' }) }})

T2: ä¸Šä¼  100 ä¸ªæ–‡ä»¶
    â†’ æ¯ä¸ªä»»åŠ¡ä¿å­˜å¿«ç…§: { hooks: { onCheck: () => ({ datasetId: 'A' }) }}
    â†’ 3 ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œ97 ä¸ªåœ¨é˜Ÿåˆ—

T3: åˆ‡æ¢åˆ° datasetId = 'B'
    â†’ setup({ hooks: { onCheck: () => ({ datasetId: 'B' }) }})
    â†’ å…¨å±€é…ç½®æ›´æ–°

T4: é˜Ÿåˆ—ä¸­çš„æ—§ä»»åŠ¡å¼€å§‹æ‰§è¡Œ
    â†’ âœ… ä½¿ç”¨å¿«ç…§é…ç½®ï¼ŒdatasetId = 'A'
    â†’ âœ… æ•°æ®ä¸ä¼šæ··ä¹±

T5: æ–°ä¸Šä¼ æ–‡ä»¶
    â†’ âœ… ä½¿ç”¨æ–°é…ç½®ï¼ŒdatasetId = 'B'
```

## é—­åŒ…é™·é˜±åŠé¿å…æ–¹æ³•

### âŒ é”™è¯¯å†™æ³•ï¼ˆä½¿ç”¨ useRef + ç©ºä¾èµ–ï¼‰

```typescript
function DatasetUpload() {
    const [datasetId, setDatasetId] = useState("A")
    const datasetIdRef = useRef(datasetId)
    datasetIdRef.current = datasetId

    useEffect(() => {
        setup({
            hooks: {
                // ğŸ”´ é—­åŒ…é™·é˜±ï¼å³ä½¿å¿«ç…§ï¼Œä¹Ÿä¼šè¯»å–åˆ°æœ€æ–°å€¼
                onCheck: () => ({ datasetId: datasetIdRef.current })
            }
        })
    }, []) // ğŸ”´ ç©ºä¾èµ–ï¼Œhook å‡½æ•°ä¸ä¼šé‡æ–°åˆ›å»º

    // ...
}
```

**é—®é¢˜**ï¼š`onCheck` å‡½æ•°åªåˆ›å»ºä¸€æ¬¡ï¼Œå†…éƒ¨å¼•ç”¨çš„æ˜¯ `datasetIdRef` å¯¹è±¡ï¼Œ`datasetIdRef.current` ä¼šå˜åŒ–ï¼Œå¯¼è‡´æ—§ä»»åŠ¡è¯»å–åˆ°æ–°å€¼ã€‚

### âœ… æ­£ç¡®å†™æ³•ï¼ˆä½¿ç”¨ä¾èµ–æ•°ç»„ï¼‰

```typescript
useEffect(() => {
    setup({
        hooks: {
            // âœ… æ¯æ¬¡ datasetId å˜åŒ–ï¼Œéƒ½åˆ›å»ºæ–°å‡½æ•°
            onCheck: () => ({ datasetId })
        }
    })

    return () => reset()
}, [datasetId]) // âœ… ä¾èµ– datasetId
```

## æœ€ä½³å®è·µ

1. **ä½¿ç”¨ä¾èµ–æ•°ç»„**ï¼šç¡®ä¿ `hooks` ä¸­çš„å‡½æ•°åœ¨ä¸Šä¸‹æ–‡å˜åŒ–æ—¶é‡æ–°åˆ›å»º
2. **ç»„ä»¶æ¸…ç†**ï¼šåœ¨ `useEffect` çš„æ¸…ç†å‡½æ•°ä¸­è°ƒç”¨ `reset()`
3. **é¿å… useRef**ï¼šä¸è¦ç”¨ `useRef` ç»•è¿‡ä¾èµ–æ£€æŸ¥ï¼Œè¿™ä¼šå¯¼è‡´é—­åŒ…é™·é˜±
4. **ç†è§£åˆ†å±‚**ï¼šåŒºåˆ†å“ªäº›é…ç½®æ˜¯å…¨å±€çš„ï¼ˆå®æ—¶æ›´æ–°ï¼‰ï¼Œå“ªäº›æ˜¯ä»»åŠ¡çº§çš„ï¼ˆå¿«ç…§ä¿å­˜ï¼‰

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸ä½¿ç”¨æ–°çš„ hooksï¼Ÿ

A: è¿™æ˜¯è®¾è®¡è¡Œä¸ºï¼Œä¸æ˜¯ Bugã€‚ä»»åŠ¡åˆ›å»ºæ—¶ä¿å­˜äº†é…ç½®å¿«ç…§ï¼Œä¿è¯ä»»åŠ¡æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ä¸€è‡´æ€§ã€‚å¦‚æœéœ€è¦æ›´æ–°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œåº”è¯¥å–æ¶ˆæ—§ä»»åŠ¡ï¼Œé‡æ–°åˆ›å»ºæ–°ä»»åŠ¡ã€‚

### Q: å¦‚ä½•è®©é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä½¿ç”¨æ–° tokenï¼Ÿ

A: `token` æ˜¯å…¨å±€é…ç½®ï¼Œæ›´æ–°åç«‹å³å¯¹æ‰€æœ‰ä»»åŠ¡ç”Ÿæ•ˆï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚

### Q: ç»„ä»¶åˆ‡æ¢åï¼Œæ—§ä»»åŠ¡è¿˜åœ¨ä¸Šä¼ æ€ä¹ˆåŠï¼Ÿ

A: åœ¨ç»„ä»¶çš„ `useEffect` æ¸…ç†å‡½æ•°ä¸­è°ƒç”¨ `reset()`ï¼Œæ¸…ç†æ—§ä»»åŠ¡ã€‚

```typescript
useEffect(() => {
    setup({
        /* ... */
    })

    return () => {
        reset() // æ¸…ç†æ‰€æœ‰ä»»åŠ¡
    }
}, [datasetId])
```
